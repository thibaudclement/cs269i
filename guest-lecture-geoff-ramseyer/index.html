
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../lecture-14/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Incentive (Mis)alignment in Blockchain Exchanges - Stanford CS269I Course Notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-goes-wrong-building-exchanges-on-a-blockchain" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Stanford CS269I Course Notes" class="md-header__button md-logo" aria-label="Stanford CS269I Course Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stanford CS269I Course Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Incentive (Mis)alignment in Blockchain Exchanges
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Stanford CS269I Course Notes" class="md-nav__button md-logo" aria-label="Stanford CS269I Course Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Stanford CS269I Course Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    One-Sided Matching and Serial Dictatorship
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stable Two-Sided Matchings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Online Learning and Regret Minimization
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-3-2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top Trading Cycles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equilibria in Games
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P File-sharing Dilemma
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Market Equilibrium
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Market Failures
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Auctions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prediction Markets and Information Cascades
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-9.5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mid-Quarter Review Party
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../guest-lecture-eric-neyman/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to Train an AI That Doesn't Lie
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scoring Rules
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../guest-lecture-kshipra-bhawalkar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incentives in Sponsored Search Auctions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proof-of-Work Blockchains
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proof-of-Stake Blockchains
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Markets
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Envy and Fairness
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Incentive (Mis)alignment in Blockchain Exchanges
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Incentive (Mis)alignment in Blockchain Exchanges
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-goes-wrong-building-exchanges-on-a-blockchain" class="md-nav__link">
    <span class="md-ellipsis">
      What Goes Wrong Building Exchanges on a Blockchain?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-can-we-design-exchanges-to-run-well-on-a-blockchain" class="md-nav__link">
    <span class="md-ellipsis">
      How Can We Design Exchanges to Run Well on a Blockchain?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-goes-wrong-building-exchanges-on-a-blockchain" class="md-nav__link">
    <span class="md-ellipsis">
      What Goes Wrong Building Exchanges on a Blockchain?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-can-we-design-exchanges-to-run-well-on-a-blockchain" class="md-nav__link">
    <span class="md-ellipsis">
      How Can We Design Exchanges to Run Well on a Blockchain?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Incentive (Mis)alignment in Blockchain Exchanges</h1>

<p><em>June 2, 2025</em></p>
<div class="remark">
<p><strong>Moral:</strong> Mismatch between system architectures and user incentives leads to broken systems, inefficiency, and (if you can exploit it) profit.</p>
</div>
<h2 id="what-goes-wrong-building-exchanges-on-a-blockchain">What Goes Wrong Building Exchanges on a Blockchain?</h2>
<div class="definition">
<p><strong>What is a blockchain?</strong></p>
<ol>
<li>A user broadcasts a transaction to the validators.</li>
<li>Validators run a consensus protocol to confirm the transaction.</li>
<li>Transaction executes on the state machine.</li>
</ol>
<p><img alt="What is a blockchain" src="../images/What%20is%20a%20blockchain.png" /></p>
</div>
<p><strong>Why is this design useful?</strong></p>
<ul>
<li>Run arbitrary logic inside the state machine: For example, an exchange.</li>
<li>Simulate a neutral, “trusted third party”:<ul>
<li>Ideally, don’t have to trust one entity to execute transactions correctly.</li>
<li>Spoiler: that’s only partially true.</li>
</ul>
</li>
</ul>
<div class="example">
<p><strong>Example: An Exchange on a Blockchain</strong></p>
<p><img alt="An Exchange on a Blockchain 1" src="../images/An%20Exchange%20on%20a%20Blockchain%201.png" /></p>
<p><img alt="An Exchange on a Blockchain 2" src="../images/An%20Exchange%20on%20a%20Blockchain%202.png" /></p>
<p><img alt="An Exchange on a Blockchain 3" src="../images/An%20Exchange%20on%20a%20Blockchain%203.png" /></p>
<p><img alt="An Exchange on a Blockchain 4" src="../images/An%20Exchange%20on%20a%20Blockchain%204.png" /></p>
<p><img alt="An Exchange on a Blockchain 5" src="../images/An%20Exchange%20on%20a%20Blockchain%205.png" /></p>
<p><img alt="An Exchange on a Blockchain 6" src="../images/An%20Exchange%20on%20a%20Blockchain%206.png" /></p>
</div>
<p><strong>Where does this convenient story break down?</strong></p>
<ol>
<li>Many users concurrently broadcast many transactions to the validators.</li>
<li>One validator proposes a new ordered list (a “block”) of transactions.</li>
<li>Validators run a consensus protocol to confirm the proposed block (consensus is generally expensive and slow (several network hops).</li>
<li>Transactions execute very slowly on the state machine.</li>
</ol>
<p><strong>How does this break an exchange?</strong></p>
<ul>
<li>Manipulate ordering for profit<ul>
<li>Historically called "Miner Extractable Value" or "MEV".</li>
<li>Illegal on regulated exchanges.</li>
</ul>
</li>
<li>On Ethereum: front-running widespread, most blocks produced by 2 or 3 entities.</li>
</ul>
<p><img alt="Break an exchange.png" src="../images/Break%20an%20exchange.png" /></p>
<ul>
<li>Any speed advantage can be profitable:<ul>
<li>High-frequency trading.</li>
<li>Why? Making decisions later is like seeing the future.</li>
<li>E.g., compare with price on Binance/Coinbase.</li>
</ul>
</li>
<li>Most chains: one block per 0.5s to 12s (each consensus protocol has its own nuances).</li>
<li>Proposer can put their transaction attop of block.</li>
</ul>
<p><strong>What makes a blockchain exchange so computationally expensive?</strong></p>
<ul>
<li>Worst-case sequential workload.</li>
<li>Heterogenous hardware, software sandboxing blocks optimization.</li>
<li>Today’s decentralized exchanges do more work than traditional exchanges<ul>
<li>Pseudonymity requires atomic settlement.</li>
<li>Many decentralized exchanges offer atomic multi-hop trades.</li>
</ul>
</li>
</ul>
<div class="example">
<p><strong>Example: Wall Street's Shortcut Is Delayed Settlement</strong></p>
<p>Settlement risk prevents open access.</p>
<p><img alt="Wall Street delayed settlement" src="../images/Wall%20Street%20delayed%20settlement.png" /></p>
</div>
<div class="example">
<p><strong>Example: Multi-Hop Trades &amp; Cyclic Arbitrage</strong></p>
<p><img alt="Multi-Hop Trades and Cyclic Arbitrage 1" src="../images/Multi-Hop%20Trades%20and%20Cyclic%20Arbitrage%201.png" /></p>
<p><img alt="Multi-Hop Trades and Cyclic Arbitrage 2" src="../images/Multi-Hop%20Trades%20and%20Cyclic%20Arbitrage%202.png" /></p>
<p><img alt="Multi-Hop Trades and Cyclic Arbitrage 3" src="../images/Multi-Hop%20Trades%20and%20Cyclic%20Arbitrage%203.png" /></p>
</div>
<p><strong>What can we do differently?</strong></p>
<ul>
<li>Off-chain matching, like Wall Street (Off-chain matching with on-chain settlement is likely coming soon).</li>
<li>Simplify computation (Automated market-making)</li>
<li>Auction for top-of-block trade [Adams, Moallemi, Reynolds, Robinson 2024]</li>
<li>...</li>
</ul>
<div class="remark">
<p><strong>Detour: Automated Market-Makers</strong></p>
<ul>
<li>Specify a full “trading strategy”, defined by a curve</li>
<li>What are the tradeoffs of this (passive) mechanism?</li>
</ul>
<p><img alt="Automated Market-Makers" src="../images/Automated%20Market-Makers.png" /></p>
</div>
<h2 id="how-can-we-design-exchanges-to-run-well-on-a-blockchain">How Can We Design Exchanges to Run Well on a Blockchain?</h2>
<p><strong>Many problems result from a mismatch between abstract design and implementation: can we use a different system design?</strong></p>
<ul>
<li>What might a state machine (exchange) that uses the blockchains block structure look like?</li>
<li><strong>Key requirement:</strong> A deterministic state machine that executes unordered blocks of commutative transactions.</li>
</ul>
<p><img alt="A different system design" src="../images/A%20different%20system%20design.png" /></p>
<p><strong>Problem:</strong> Ordering determines pricing in an exchange.</p>
<p><strong>Solution:</strong> A Different Pricing Mechanism</p>
<ul>
<li>Input: Set of Open Offers</li>
<li>Step 1: Compute Valuations</li>
<li>Step 2: Trade with Exchange at Valuation Quotients<ul>
<li>Meaningless units</li>
<li>No pairwise matching!</li>
</ul>
</li>
<li>“Clearing” if no debt.</li>
</ul>
<p><img alt="Different Pricing Mechanism" src="../images/Different%20Pricing%20Mechanism.png" /></p>
<p><strong>Why is this useful?</strong></p>
<ul>
<li>Computational Performance: A deterministic state machine that executes unordered blocks of commutative transactions.</li>
<li>Key: Every offer trades by itself, at batch prices.</li>
<li>Target: Millions of open offers, a batch every couple of seconds.</li>
</ul>
<div class="theorem">
<p><strong>Theorem:</strong> Arrow and Debreu, 1954</p>
<p>There always exists a unique<span class="arithmatex">\(^\star\)</span> set of valuations <span class="arithmatex">\(\{p_A\}\)</span> that clears the market.</p>
</div>
<p><strong>Why Uniform Clearing Valuations?</strong></p>
<p>Economic Performance:</p>
<ul>
<li>No In-Batch Front-Running<ul>
<li>Everyone gets the same rates</li>
<li>Open question: MEV and low-latency advantage?</li>
</ul>
</li>
<li>Optimal Trade Routing &amp; Eliminate Cyclic Arbitrage</li>
</ul>
<p><img alt="Uniform Clearing Valuations" src="../images/Uniform%20Clearing%20Valuations.png" /></p>
<blockquote>
<p>“... I am receptive to more flexible, competitive solutions that could be adopted by trading venues. These could include frequent batch auctions or other mechanisms designed to minimize speed advantages."—SEC Chair Mary Jo White, June 5, 2014</p>
</blockquote>
<ul>
<li>The cost of batch trading is latency</li>
<li>Active research area (2-asset case)<ul>
<li>[Budish, Crampton, and Shim, 2015]</li>
<li>[Aquilina, Budish, and O’Neill, 2022]</li>
<li>[Indriawan, Pascual, and Shkilko, 2024]</li>
<li>[Lee, Riccò, and Wang, 2023] [Jagannathan, 2019]</li>
<li>...</li>
</ul>
</li>
</ul>
<div class="definition">
<p><strong>Background:</strong> Arrow-Debreu Exchange Markets</p>
<ul>
<li><span class="arithmatex">\(N\)</span> agents, <span class="arithmatex">\(M\)</span> (divisible, fungible) goods.</li>
<li>Agent <span class="arithmatex">\(i\)</span> has endowment <span class="arithmatex">\(e_i \in \mathbb{R}_{\geq 0}^M\)</span> and quasi concave utility <span class="arithmatex">\(u_i : \mathbb{R}_{\geq 0}^M → \mathbb{R}\)</span>.</li>
<li>The “Market” specifies prices <span class="arithmatex">\(\{p_j\}_{j \in [N]}\)</span></li>
<li>Each agent sells their endowment to buy <span class="arithmatex">\(x_i \in \mathbb{R}_{\geq 0}^M\)</span> that maximises their utility.</li>
<li><span class="arithmatex">\(p \cdot e_i \geq p \cdot x_i\)</span>.</li>
<li><span class="arithmatex">\((p, x)\)</span> is equilibrium if all assets conserved (or price is 0).</li>
</ul>
<p>We need to compute an equilibrium efficient at scale.</p>
</div>
<div class="theorem">
<p><strong>Theorem:</strong> Arrow and Debreu, 1954</p>
<p><s>There always exists a unique<span class="arithmatex">\(^\star\)</span></s> set of valuations <span class="arithmatex">\(\{p_A\}\)</span> that clears the market.</p>
<ul>
<li>May not exist.</li>
<li>May not be unique.</li>
<li>May not be computationally tractable to find (PPAD-complete).</li>
</ul>
</div>
<p><strong>Correspondence with Exchange Markets</strong></p>
<ul>
<li>Offer to sell <span class="arithmatex">\(e\)</span> units of <span class="arithmatex">\(M\)</span> for <span class="arithmatex">\(Y\)</span>, at a minimum price <span class="arithmatex">\(r &gt; 0\)</span>.</li>
<li>Equivalent: maximize <span class="arithmatex">\(u(x,y) = r \cdot x + y\)</span> subject to <span class="arithmatex">\(p \cdot x + y \leq p \cdot e\)</span>.</li>
<li>Key points<ul>
<li>Linear utilities</li>
<li>Non zero minimum prices</li>
<li>Sparse utilities</li>
</ul>
</li>
</ul>
<div class="theorem">
<p><strong>Theorem:</strong> There always exists an equilibrum, and all equilibria share the same exchange rates or there is no trading activity.</p>
</div>
<p><strong>How Can We Compute Equilibria At Scale?</strong></p>
<ul>
<li>2-asset case (easy): Binary Search.</li>
<li>Many-asset case: Many curves, high-dimensional search space.</li>
</ul>
<p><img alt="Compute Equilibria At Scale" src="../images/Compute%20Equilibria%20At%20Scale.png" /></p>
<p>Classic theory problem</p>
<ul>
<li>Iterative processes (Tâtonnement [CMV05])</li>
<li>Convex programs ([DGV13])</li>
<li>Network flows, iterative auctions ([DPSV04], ...)</li>
<li>Interior point methods ([Ye08])</li>
</ul>
<p><strong>Fast Equilibria Computation</strong></p>
<ul>
<li>Geoff's team's approach: Tâtonnement (basedon[CMV05])</li>
<li>Iteration runtime <span class="arithmatex">\(O (\#assets ^2 \cdot \log(\#offers ) )\)</span><ul>
<li>Incrementally sort offers by limit price</li>
<li><span class="arithmatex">\(\approx 100μs\)</span> per iteration, <span class="arithmatex">\(\approx 1000\)</span> iterations</li>
<li>Memory access pattern is extremely cache-friendly</li>
</ul>
</li>
</ul>
<p><img alt="Fast Equilibria Computation" src="../images/Fast%20Equilibria%20Computation.png" /></p>
<p><strong>Approximate Equilibria Computation</strong></p>
<ul>
<li>Exact calculation is intractable (infinite precision)</li>
<li>Wem ust be careful:<ul>
<li>We cannot mint money</li>
<li>We cannot make invalid trades</li>
<li>We cannot ...</li>
</ul>
</li>
</ul>
<p><strong>2 Acceptable Approximations</strong></p>
<ul>
<li>Demand Smoothing: Smooth thresholds<ul>
<li>Reduces iterative oscillation</li>
<li>Experiments use <span class="arithmatex">\(2^{-10} \approx 0.1\%\)</span></li>
</ul>
</li>
</ul>
<p><img alt="Demand Smoothing" src="../images/Demand%20Smoothing.png" /></p>
<ul>
<li>Transaction Fees: Charge small percentage fee<ul>
<li>Range of approximate clearing prices, not single point</li>
<li>Experiments use <span class="arithmatex">\(2^{-15} \approx 0.003\%\)</span></li>
</ul>
</li>
</ul>
<p><img alt="Transaction Fees" src="../images/Transaction%20Fees.png" /></p>
<div class="definition">
<p><strong>Accounting for Approximation: Prices into Trades</strong></p>
<p><span class="arithmatex">\(max\)</span> Trade Volume (at Tâtonnement’s Prices):</p>
<div class="arithmatex">\[
  \displaystyle max \sum_{\Alpha,\Beta} p_{\Alpha} x_{\Alpha \Beta}
\]</div>
<p><span class="arithmatex">\(s.t.\)</span> Correct (Smoothed) Offer Execution:</p>
<div class="arithmatex">\[
  \displaystyle s.t. \; p_{\Alpha} L_{\Alpha \Beta} (\frac{p_{\Alpha}}{p_{\Beta}}) \leq p_{\Alpha} x_{\Alpha \Beta} \leq p_{\Alpha} U_{\Alpha \Beta} (\frac{p_{\Alpha}}{p_{\Beta}}) \; \forall \Alpha,\Beta
\]</div>
<p>Assets Conserved (After Fees):</p>
<div class="arithmatex">\[
  p_{\Alpha} \sum_{\Beta} x_{\Alpha \Beta} \geq (1 - fee) \sum_{\Beta} p_{\Beta}x_{\Beta \Alpha} \; \forall \Alpha
\]</div>
</div>
<p><strong>Overall Performance</strong></p>
<ul>
<li>Linear Scalability (contention with background work (logging))</li>
<li>Log Dependence on <span class="arithmatex">\(\#offers\)</span></li>
</ul>
<p><img alt="Overall Performance" src="../images/Overall%20Performance.png" /></p>
<p><strong>Tradeoff: Batch Latency</strong></p>
<ul>
<li>Cost of batch exchange model is trade latency: If we’re already paying for consensus latency, the marginal cost is 0.</li>
<li>Does this latency matter?<ul>
<li>This is a policy question, not a technical question</li>
<li>Good policymaking requires mapping out the entire designs pace</li>
</ul>
</li>
</ul>
<p><strong>Implementation</strong></p>
<ul>
<li>Self-contained replicated state machine:<ul>
<li><a href="https://github.com/scslab/speedex">https://github.com/scslab/speedex</a></li>
<li><span class="arithmatex">\(\approx 30,000\)</span> LOC (C++20)</li>
</ul>
</li>
<li>Planned (then cancelled? then uncancelled and cancelled again? unclear) deployment in Stellar (a public blockchain):<ul>
<li><a href="https://github.com/gramseyer/stellar-core">https://github.com/gramseyer/stellar-core</a></li>
<li>Required only <span class="arithmatex">\(\approx 2,000\)</span> LOC (C++17)</li>
<li>Commutative semantics and economic improvements valuable on their own: This is the only piece that needs a coordinated upgrade (“hardfork")</li>
<li>Implement scaling later, as needed (much easier)</li>
</ul>
</li>
</ul>
<p><strong>Constraints from the Stellar Implementation</strong></p>
<ul>
<li>Limiting factors on scaling number of assets:<ul>
<li>Tâtonnement iteration runtime</li>
<li>A fewhundred is probably fine</li>
<li>Linear program runtime (Off the shelf solver becomes a problem around <span class="arithmatex">\(\approx 80\)</span> assets</li>
</ul>
</li>
<li>Hard (legal) constraint: Can’t charge trading fees</li>
<li>Need absolute runtime guarantee</li>
</ul>
<p><strong>Accounting for Stellar’s Constraints</strong></p>
<ul>
<li>Run Tâtonnement as normal, then solve this (different) LP</li>
<li>Cannot enforce lower bound on <span class="arithmatex">\(x_{AB}\)</span> (cannot guarantee LP feasibility)—Also allows guaranteed runtime bound</li>
<li>Linear program without fees is “totally unimodular”:<ul>
<li><span class="arithmatex">\(p_{\Alpha} x_{\Alpha \Beta} \rightarrow y_{\Alpha \Beta}\)</span></li>
<li>Much faster to solve (flow problem)</li>
</ul>
</li>
</ul>
<p><strong>Everything Else in an Exchange</strong></p>
<ul>
<li>Asset transfers</li>
<li>Replay prevention</li>
<li>Signatures</li>
<li>Double-spends</li>
<li>...</li>
</ul>
<div class="example">
<p><strong>Example:</strong> Payments</p>
<p><img alt="Example Exchange Payments" src="../images/Example%20Exchange%20Payments.png" /></p>
<p><strong>Reading from a Snapshot:</strong> What if two transactions write to the same location?</p>
<p><img alt="Reading from a snapshot" src="../images/Reading%20from%20a%20snapshot.png" /></p>
<p><strong>Typed State Changes: What if a balance becomes negative?</strong></p>
<p><img alt="Typed State Changes" src="../images/Typed%20State%20Changes.png" /></p>
<p><strong>Preempt constraint conflicts when assembling new blocks</strong></p>
<p>Efficient reserve-commit process (2-phase commit)</p>
<p><img alt="Reserve-commit process" src="../images/Reserve-commit%20process.png" /></p>
<p>“Snapshot Reads” + “Conflict-sometimes-Replicated Data Types”</p>
<p><img alt="Conflict-sometimes-Replicated Data Types" src="../images/Conflict-sometimes-Replicated%20Data%20Types.png" /></p>
</div>
<div class="remark">
<p><strong>Detour: Smart Contracts</strong></p>
<ul>
<li>We can give these tools to a smart contract-Not just for purpose-built applications</li>
<li>For example: Lending markets and collateral deposits</li>
<li>Groundhog [Ramseyer-Mazières, 2023]-Context: this is Geoff's day job</li>
<li>Open question: What applications need purpose-built mechanisms, and what do not?</li>
</ul>
</div>
<h2 id="recap">Recap</h2>
<div class="summary">
<p><strong>Incentive (Mis)alignment in Blockchain Exchanges Recap</strong></p>
<ul>
<li>Mismatch between blockchain abstaction and implementation</li>
<li>Especially bad for implementing an exchange (Arbitrage spam, front-running, MEV, ...)</li>
<li>How can we redesign an exchange to fit on a blockchain?</li>
<li>Different computational model: State machine on unordered batches of transactions</li>
<li>Exchange needs a different pricing mechanism (Compute Arrow-Debreu equilibria efficiently)</li>
</ul>
</div>
<div class="remark">
<p><strong>Moral:</strong> Mismatch between system architectures and user incentives leads to broken systems, inefficiency, and (if you can exploit it) profit.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
      
        <script src="../javascript/katex-init.js"></script>
      
    
  </body>
</html>