
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../lecture5/">
      
      
        <link rel="next" href="../lecture7/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Market Equilibrium - Stanford CS269I Course Notes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#market-equilibrium" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Stanford CS269I Course Notes" class="md-header__button md-logo" aria-label="Stanford CS269I Course Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stanford CS269I Course Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Market Equilibrium
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Stanford CS269I Course Notes" class="md-nav__button md-logo" aria-label="Stanford CS269I Course Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Stanford CS269I Course Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    One-Sided Matching and Serial Dictatorship
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stable Two-Sided Matchings
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Online Learning and Regret Minimization
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture3b/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top Trading Cycles
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Equilibria in Games
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    P2P File-sharing Dilemma
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Market Equilibrium
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Market Equilibrium
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modeling-buyers" class="md-nav__link">
    <span class="md-ellipsis">
      Modeling Buyers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supply-and-demand-of-fungible-goods" class="md-nav__link">
    <span class="md-ellipsis">
      Supply and Demand of Fungible Goods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supply-and-demand-of-idiosyncratic-goods" class="md-nav__link">
    <span class="md-ellipsis">
      Supply and Demand of Idiosyncratic Goods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#competitive-equilibrium-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Competitive Equilibrium Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deferred-acceptance-with-prices" class="md-nav__link">
    <span class="md-ellipsis">
      Deferred Acceptance With Prices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Market Failures
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Auctions
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modeling-buyers" class="md-nav__link">
    <span class="md-ellipsis">
      Modeling Buyers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supply-and-demand-of-fungible-goods" class="md-nav__link">
    <span class="md-ellipsis">
      Supply and Demand of Fungible Goods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supply-and-demand-of-idiosyncratic-goods" class="md-nav__link">
    <span class="md-ellipsis">
      Supply and Demand of Idiosyncratic Goods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#competitive-equilibrium-properties" class="md-nav__link">
    <span class="md-ellipsis">
      Competitive Equilibrium Properties
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deferred-acceptance-with-prices" class="md-nav__link">
    <span class="md-ellipsis">
      Deferred Acceptance With Prices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    <span class="md-ellipsis">
      Recap
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="market-equilibrium">Market Equilibrium</h1>
<p><em>April 16, 2025</em></p>
<div class="definition">
<p><strong>Definition: Market</strong></p>
<p><em>"A means by which the exchage of goods and services takes place as a result of buyers and sellers being in contact with one another, either directly or through mediating agents or situations."</em> — Joan Violet Robinson, Britannica</p>
</div>
<p>Previously, we examined scenarios without monetary transfers. Issues with non-monetary markets include:</p>
<ol>
<li>Limited to ordinal rather than cardinal preferences.</li>
<li>Emergence of underground markets.</li>
<li>Potential exploitation (bots manipulating donor lists).</li>
</ol>
<p>Starting today, we want to measure utility with money:</p>
<ul>
<li><strong>Basic assumption:</strong> How much I want something is equal to how much I am willing to pay for it.</li>
<li><strong>Obvious caveat:</strong> How much I am willing to pay depends on how much money I have.</li>
</ul>
<h2 id="modeling-buyers">Modeling Buyers</h2>
<div class="definition">
<p><strong>Definition: Cardinal Utilities vs Ordinal Utilities</strong></p>
<ul>
<li><strong>Cardinal utilities</strong>: Assign numeric values to preferences.</li>
<li><strong>Ordinal utilities</strong>: Only rank preferences by order.</li>
</ul>
</div>
<p>Is one type of utilities better than the other?</p>
<p>Cardinal utilities convey richer information (ordinal can be derived from cardinal), are intuitive in economic analysis, and typically monetarily measurable.</p>
<p>For example, in the kidney exchange program, we may not know whether we prefer one kidney over another, but we can compare two risky matches with one perfect match (one perfect match is definitely better than one risky match) with numbers by adding the happiness that the two risky patients may get and comparing it with the happiness of the one perfect match patient, which is harder to determine with only ordinal utilities.</p>
<p>In addition, we can think about probabilistic events, because when we have probabilities and numbers, we can check the expectation. If we can have a good kidney with <span class="arithmatex">\(50\%\)</span> or an okay match with <span class="arithmatex">\(70\%\)</span> (more likely), we can use expectation to compare those options, while with cardinal utilitie alone, comparison is more challenging.</p>
<p>Finally, let's note that we typically quantify cardinal utilities with money, which is good in some applications, but problematic in some other applications. There are alternatives, such as “quality-adjusted life years” in health economics, which measure how many additional years a patient may live with a kidney. It is not perfect either, but it is some way to help us make these decisions.</p>
<p>In other applications, where money is not a good idea, it is not clear what the right measure is. For instance, how do we quantify utility in education (e.g. how much utility do we get from taking CS269I?—a lot, for sure, but how much?) or in dating apps (e.g. how do we quantify how we are making better matches?)</p>
<p>In contrast, one disadvantage of cardinal utilities is that humans are better at comparing outcomes.</p>
<p>Introducing money changes market dynamics substantially:</p>
<ul>
<li>Stanford housing would differ if rooms were auctioned.</li>
<li>Buying organs is illegal in most countries.</li>
<li>Hospitals-student monetary matches face legal restrictions.</li>
</ul>
<p>However, there are also some challenges in non-monetary transfers:</p>
<ul>
<li>Without monetary transfers, we are limited to ordinal preferences.</li>
<li>When we force non-monetary transfers, people try to get their way under the table, which comes with legal issues (admissions scandal) and risks (illegal organ transplants, for both people who buy and sell organs)</li>
<li>We need a permission systems (as opposed to a permission-less system, such as the Internet or Bitcoin), otherwise,<ul>
<li>For instance in the Stanford housing lottery, you need a SUNet ID, so that applicants do not enter the draw with a bot and get a million lottery tickets.</li>
<li>With online reviews, we really have a problem with restaurants writing really good reviews for themselves and bad reviews for competing restaurants.</li>
</ul>
</li>
</ul>
<div class="definition">
<p><strong>Definition: Fungible Goods vs Idiosyncratic Goods</strong></p>
<ul>
<li><strong>Fungible goods</strong>: Interchangeable units.</li>
<li><strong>Idiosyncratic goods</strong>: Unique goods.</li>
</ul>
</div>
<p>In other words, goods are fungible when there lots of interchangeable copies of an item, such as copies of a new book. In contrast, goods idiosyncratic when they have intrinsic features. If you try to buy a house, every house is very different from the house down the street (problems with the roof, nicer garden, better location, etc.), so we need to understand the value of each house. In dating apps, it is similar: each person is very different. NFTs (Non-Fungible Tokens) by definition are idiosyncratic.</p>
<p>In practice, many things are a mix of fungible and idiosyncratic. For instance, in a ride-sharing app, we don’t really care who the driver is (the driver is fungible), but we really care where we go (the destination is idiosyncratic).</p>
<h2 id="supply-and-demand-of-fungible-goods">Supply and Demand of Fungible Goods</h2>
<div class="definition">
<p><strong>Definition: Demand Curve</strong></p>
<p>Consider a perfectly fungible good, e.g., copies of a book:</p>
<ul>
<li>1 buyer is willing to pay $10 for the book.</li>
<li>2 additional buyers are willing to pay $9 for the book.</li>
<li>1 addition buyer is willing ti pay $8 for the book.</li>
<li>Etc.</li>
</ul>
<p>We can plot this aggregate <strong>demand curve</strong>, which is typically decreasing, as more buyers are interested when the price is lower:</p>
<p><img alt="Demand Curve" src="../images/Demand%20Curve.png" /></p>
</div>
<p><strong>Note:</strong> The demand curve represents how many buyers are willing to buy at each price. We plot the Price as the y-axis and the Demand as the x-axis, even though it is really the demand as a function of the price.</p>
<div class="definition">
<p><strong>Definition: Supply Curve</strong></p>
<p>Let's specifically talk about <em>used</em> (but in identical conditions) books, which means that the books are still fungible:</p>
<ul>
<li>2 sellers are willing to give their copies for $1.</li>
<li>1 addition seller is willing to give their copy for $2.</li>
<li>3 additional sellers are willing to give their copies for $3.</li>
<li>Etc.</li>
</ul>
<p>We can plot this aggregate <strong>supply curve</strong>, which is typically increasing, at least for <em>used</em> books.</p>
<p><img alt="Supply Curve" src="../images/Supply%20Curve.png" /></p>
</div>
<p><strong>Note:</strong> The supply curve represents how many sellers are willing to sell at each price. We plot the Price as the y-axis and the Supply as the x-axis, even though it is really the supply as a function of the price.</p>
<div class="remark">
<p><strong>Side Note: Law of Supply vs. Digital Goods</strong></p>
<p>If the applies to <em>used</em> books, then what about new books?</p>
<p>The Law of Supply says that the supply curve should be increasing, but sometimes, this does not hold.</p>
<p>For instance, for new books:</p>
<ul>
<li>There is a monopoly (the publisher is selling all the copies): increasing the price does not mean that they are willing to sell it more.</li>
<li>Marginal cost of printing another book is negligible (most of the price is editorial work, promotion, etc.)</li>
</ul>
<p>If we think of digital goods, the marginal cost of making another copy is zero, so the Law of Supply does not hold anymore:</p>
<ul>
<li>For ordinary physical goods, the supply curve slopes upward because each additional unit costs a little more to make. Producers only expand output when price at least covers that rising marginal cost.</li>
<li>For a pure digital good—software, an e‑book, a music file—the marginal cost of copying and distributing one more unit is essentially zero, so a seller is already willing to supply any quantity at any price just above zero. Raising the price therefore doesn’t unlock extra output the way it does for physical goods. Instead, the constraint is usually legal (who owns the copyright) or strategic (how the seller wants to segment the market), not technological cost.</li>
</ul>
<p>In the short run the supply curve is therefore flat (perfectly elastic) at roughly zero cost, and in the long run depends on covering the fixed cost of creating the first copy rather than on the per‑unit price, so the classic Law of Supply tied to marginal production cost doesn’t bite.</p>
</div>
<div class="definition">
<p><strong>Definition: Market Clearing Price</strong></p>
<p>The price where demand and supply curves meet is called the market clearing price or market equilibrium.</p>
<p><img alt="Markeet Clearing Price" src="../images/Markeet%20Clearing%20Price.png" /></p>
</div>
<p>The vanilla assumption in classical economics is that buyers and sellers should naturally converge to the special price <span class="arithmatex">\(p^\star\)</span>, where the supply meets the demand. At market clearing price, the numbers of interested buyers and sellers are equal, so they can all transact (i.e. "clear the market").</p>
<p>This is <em>not complicated</em> but <strong>super important</strong>. The reason we call this an equilibrium is because:</p>
<ul>
<li>At that price, all the buyers who want to buy for that price can buy exactly from all the sellers who want to sell at that price (the supply is exactly meeting the demand).</li>
<li>There are some sellers who are willing to sell at a higher price, but they stay out of it.</li>
<li>There are some buyers who are willing to buy at a lower price, but they stay out of it.</li>
</ul>
<p>We are trying to think of a single price that works for the entire market. We will formalize it later, but this price <span class="arithmatex">\(p^\star\)</span> maximizes the total happiness.</p>
<h2 id="supply-and-demand-of-idiosyncratic-goods">Supply and Demand of Idiosyncratic Goods</h2>
<div class="example">
<p><strong>The Airbnb Market Model</strong></p>
<ul>
<li><span class="arithmatex">\(m\)</span> different (<strong>idiosyncratic</strong>) rooms for rent.</li>
<li><span class="arithmatex">\(n\)</span> guests, each willing to stay in at most one room (<strong>unit-demand</strong>).</li>
<li>Guest <span class="arithmatex">\(i\)</span> has <strong>value</strong> <span class="arithmatex">\(v_{i,j}\)</span> for staying in room <span class="arithmatex">\(j\)</span>.</li>
<li>If guest <span class="arithmatex">\(i\)</span> pays<span class="arithmatex">\(p_j\)</span> to stay in room <span class="arithmatex">\(j\)</span>, their happiness is given by <span class="arithmatex">\(U_{i,j} = v_{i,j} - p_j\)</span>.</li>
<li>If guest <span class="arithmatex">\(i\)</span> doesn't stay in any room (e.g., camps outside), their happiness is given by <span class="arithmatex">\(U_{i,\emptyset} = 0\)</span>.</li>
</ul>
</div>
<div class="example">
<p><strong>The Airbnb Market Model (in Economics Jargon)</strong></p>
<ul>
<li><span class="arithmatex">\(m\)</span> different (<strong>idiosyncratic</strong>) goods for rent.</li>
<li><span class="arithmatex">\(n\)</span> buyers, each willing to buy at most one good (<strong>unit-demand</strong>).</li>
<li>Buyer <span class="arithmatex">\(i\)</span> has <strong>value</strong> <span class="arithmatex">\(v_{i,j}\)</span> for buying good <span class="arithmatex">\(j\)</span>.</li>
<li>If buyer <span class="arithmatex">\(i\)</span> pays<span class="arithmatex">\(p_j\)</span> for good <span class="arithmatex">\(j\)</span>, their utility is given by <span class="arithmatex">\(U_{i,j} = v_{i,j} - p_j\)</span>.</li>
<li>If buyer <span class="arithmatex">\(i\)</span> doesn't buy any good (e.g., camps outside), their utility is given by <span class="arithmatex">\(U_{i,\emptyset} = 0\)</span>.</li>
</ul>
</div>
<div class="definition">
<p><strong>Definition: Competitive Equilibrium</strong></p>
<p>A competitive equilibrium is the combination of a price vector <span class="arithmatex">\(\overrightarrow{p} = (p_1, ..., p_n)\)</span> and a matching <span class="arithmatex">\(M\)</span> of buyers to goods, such that:</p>
<ul>
<li>Each buyer is matched to their favorite good (given prices): </li>
</ul>
<div class="arithmatex">\[
\forall i,j' v_{i,M(i)} - p_{M(i)} \geq v_{i,j'} - p_{j'}.
\]</div>
<ul>
<li>If no buyer is matched to good <span class="arithmatex">\(j\)</span>, then <span class="arithmatex">\(p_j = 0\)</span>.</li>
</ul>
</div>
<p>There is one more condition for a competitive equilibrium. If a buyer is not matched, that means that they don’t want any good. This means that the utility for every good is negative (the value minus what it would cost them is negative). So, they stay unmatched (they have the option to remain unmatched).</p>
<p>This is an <em>important concept</em> called <strong>individual rationality</strong>: no agent is strictly less happy after participating in the mechanism. In other words, every buyer is no worse after transacting than they were before. If they cannot find anything in their price range, they don’t get anything: they don’t lose money by just going to the site and checking all the options.</p>
<p><strong>Question 1: How is it possible that every buyer is matched to their favorite good? What if everyone wants the same good?</strong></p>
<p>The intuition to manage this is through prices, because if a good is over-demanded, we increase the price, until buyers leave it.</p>
<p><strong>Question 2: What if there are two buyers with the exact same utility?</strong></p>
<p>Because we have a weak inequality (rather than a strict inequality), it means that every buyer is matched until they do not have another good that they prefer, so if two buyers have the same utility, we can increase the price until they are indifferent between two rooms, and then we can give either room to either buyer and they will both be happy.</p>
<p><strong>Question 3: What if there are two people who are willing to pay $6B for the same room?</strong></p>
<p>We increase the price to <span class="arithmatex">\(\$6\)</span>B, and at that point, they are indifferent between getting the room for <span class="arithmatex">\(\$6\)</span>B and not getting any room (or getting another cheap room), so we can tie-break arbitrarily and give the room to one of them.</p>
<p><strong>Question 4: Does buying the room provide additional utility, such as the satisfaction of winning the auction and showing off?</strong>
We are not modeling this here. It is just that every buyer has some value for each good, but they do not care about what everyone else is getting.</p>
<div class="proof">
<p><strong>Why is a competitive equilibrium an equilibrium?</strong></p>
<p><strong>Reminder:</strong> In a competitive equilibrium:</p>
<ol>
<li>Each buyer is matched to their favorit good (given prices) or no good if they don't want any.</li>
<li>If no buyer is matched to good <span class="arithmatex">\(j\)</span>, then <span class="arithmatex">\(p_j = 0\)</span>.</li>
</ol>
<p>Therefore:</p>
<ul>
<li>By <span class="arithmatex">\((1)\)</span>, no buyer wants to deviate to a different room, they are given their favorite room given the prices.</li>
<li>No good is over-demanded (we are matching each buyer to a room, but we are not matching two buyers to the same room), so no there is no pressure to increase prices.</li>
<li>By <span class="arithmatex">\((2)\)</span>, under-demanded goods are priced at <span class="arithmatex">\(0\)</span>, so we can't decrease their price lower any more.</li>
</ul>
</div>
<div class="remark">
<p><strong>Important Note</strong></p>
<p>Aviad pointed out a notion that is always confusing for students: A competitive equilibrium is the combination of prices and the assignment of guests to rooms <strong>together</strong> (all of that constitute the equilibrium, not just one or the other).</p>
<p>The last condition essentially says that there is always an empty room that is priced at <span class="arithmatex">\(0\)</span>. Buyers compare all available rooms at their respective prices, but they also compare those with the option of not getting a room and not paying any price (staying in a tent for instance).</p>
</div>
<p><strong>Question: What about seller’s utility?</strong></p>
<p>This already captures seller’s utility. What this does not capture is production cost. This definition makes sense if we assume that sellers have <span class="arithmatex">\(0\)</span> cost, which we will pretend for now, which in practice is not true but we will hide it to keep things simpler.</p>
<p><strong>Question: Why if no buyer is matched to a good, then the price is 0?</strong></p>
<p>If a good is unpopular and no one wants it, we don’t know if it is because it is priced too high, or because it is bad (e.g. a room in a bad neighborhood). So, we lower the price, and we lower the price, until it reaches <span class="arithmatex">\(0\)</span>. If nobody wants it anyway, we know that the price is not too high.</p>
<h2 id="competitive-equilibrium-properties">Competitive Equilibrium Properties</h2>
<p>Anywhere in the world, we can go on Airbnb (from Brazil on a tablet, from India on a phone), and look up rooms in Paris. Once we have equilibrium prices, Airbnb can show all the rooms, with all the prices, to all the guests around the world, and there are not going to be conflicts (unlike when everyone is trying to “enroll now” in some classes with limited seats). The equilibrium prices coordinate things in such a way that no two people want the same room.</p>
<p>In practice, it is an approximate equilibrium, so there might be conflicts, but the main thing that makes Airbnb different from Stanford classes or Burning Man tickets (where prices are fixed and good are over-demanded) is that prices are an approximate equilibrium.</p>
<p>From a pure computer science system design perspective (leaving aside economics), equilibrium prices are great because the system is not going to crash (since people want different rooms).</p>
<div class="definition">
<p><strong>Definition: Social Welfare</strong></p>
<p>The social welfare of an allocation <span class="arithmatex">\(M\)</span> is the total buyers' value: <span class="arithmatex">\(\underset{i}{\sum} v_{i,M(i)}\)</span>.</p>
</div>
<p><strong>Question: Why don't we include prices in the definition of social welfare?</strong></p>
<p>We did not include prices in the definition of social welfare, even though happiness is equal to the value minus the price, because we count the total utility of everyone, including sellers, so prices they cancel out.</p>
<p>The price goes from the buyers to the sellers, so it is zero-sum, it does not change the total happiness, while what changes the total happiness is the quality of the matching.</p>
<p>In contrast, if we wanted to calculate the total happiness of only the buyers, then we would subtract the prices, and if we wanted to calculate the total happiness of only the sellers, we would only care about the prices (this is called revenue maximization).</p>
<p>We are also abstracting a bunch of things, such as production costs (including cleaning fees), and taxes (which may make the government happy).</p>
<div class="theorem">
<p><strong>Theorem: First Welfare Theorem</strong></p>
<p>If <span class="arithmatex">\((p,M)\)</span> is a competitive equilibrium, then <span class="arithmatex">\(M\)</span> is a matching that maximizes social welfare:</p>
<div class="arithmatex">\[
\forall M' \; \underset{i}{\sum} v_{i,M(i)} \geq \underset{i}{\sum} v_{i,M'(i)}
\]</div>
</div>
<p>Another amazing aspect of competitive equilibrium prices is that they maximize the total happiness (social welfare). In any competitive equilibrium, the matching maximizes the total sum of values. If we compare the matching <span class="arithmatex">\(M\)</span> to any other matching <span class="arithmatex">\(M'\)</span>, the welfare in <span class="arithmatex">\(M\)</span> at least the welfare in <span class="arithmatex">\(M'\)</span>. Competitive equilibrium prices are making Airbnb happy (they are making a lot of money), the hosts happy (they rent their houses), and guests happy (they find rooms to stay in).</p>
<div class="proof">
<p><strong>Proof: A competitive equilibrium is optimal.</strong></p>
<p>Assume by contradiction that <span class="arithmatex">\(\exists M' \; \underset{i}{\sum} v_{i,M(i)} &lt; \underset{i}{\sum} v_{i,M'(i)}\)</span>.</p>
<p>By <span class="arithmatex">\((1)\)</span>, <span class="arithmatex">\(\underset{i}{\sum} (v_{i,M(i)} - p_{M(i)}) \geq \underset{i}{\sum} (v_{i,M'(i)} - p_{M'(i)})\)</span>.</p>
<p>Therefore, <span class="arithmatex">\(\underset{i}{\sum} p_{M(i)} &lt; \underset{i}{\sum} p_{M'(i)}\)</span>.</p>
<p>But, by <span class="arithmatex">\((2)\)</span>, <span class="arithmatex">\(\underset{i}{\sum} p_{M(i)} = \underset{j}{\sum} p_j \geq \underset{i}{\sum} p_{M'(i)}\)</span>.</p>
<p>We have reached a contradiction, so <span class="arithmatex">\(\forall M' \; \underset{i}{\sum} v_{i,M(i)} \geq \underset{i}{\sum} v_{i,M'(i)}\)</span>.</p>
</div>
<p>As a reminder, the First Welfare Theorem tells us that the total sum of values is maximized at the competitive equilibrium matching <span class="arithmatex">\(M\)</span>. It is helpful to remember that the statement about total happiness does <em>not</em> include prices anywhere.</p>
<p>We assume that there is a matching <span class="arithmatex">\(M'\)</span> that violates the inequality in the theorem statement, i.e. <span class="arithmatex">\(M'\)</span> has some strictly higher total happiness. Every <span class="arithmatex">\(i\)</span> maximizes their happiness (value minus price) at the equilibrium matching <span class="arithmatex">\(M\)</span>.</p>
<p>When we subtract both inequalities, it results that sum of prices in <span class="arithmatex">\(M\)</span> is less than the sum of prices in <span class="arithmatex">\(M'\)</span>: these are the same prices, but summed over different instances (on the left, over goods that are assigned in <span class="arithmatex">\(M\)</span>, and on the right over the goods that are assigned in <span class="arithmatex">\(M'\)</span>).</p>
<p>However, condition <span class="arithmatex">\((2)\)</span> in the definition of the competitive equilibrium tells us that any good that is not assigned in <span class="arithmatex">\(M\)</span> has a price of <span class="arithmatex">\(0\)</span>, so the sum of anything that is assigned in <span class="arithmatex">\(M\)</span> is the same as the sum of all the prices in general. Thus, the sum of all the prices has to be at least the sum of everything that is assigned in <span class="arithmatex">\(M'\)</span>.</p>
<p>On one hand, we have an inequality that says that the sum of the prices of what is assigned in <span class="arithmatex">\(M\)</span> is strictly less than in <span class="arithmatex">\(M'\)</span>, and on the other hand, we have the opposite inequality, so together, we get a contradiction.</p>
<p>What is interesting in this proof is how it uses the second condition of the definition of competitive equilibrium, which says that goods that are not assigned have a price of <span class="arithmatex">\(0\)</span>.</p>
<p><strong>Question: Why do we have this inequality where the prices of all the goods is greater than the prices of the goods matched in M’?</strong></p>
<p>There are more rooms than guests, so we are not necessarily matching all the rooms, but in <span class="arithmatex">\(M\)</span> we are matching all the rooms that have a non-zero price. It is possible that something that is matched in <span class="arithmatex">\(M\)</span> (with a positive price) is not matched in <span class="arithmatex">\(M'\)</span> (so the price is <span class="arithmatex">\(0\)</span>), because <span class="arithmatex">\(M'\)</span> does not necessarily match all the goods, since it is <em>not</em> a competitive equilibrium).</p>
<div class="theorem">
<p>In the "Airbnb market model", a competitive equilibrium always exists.</p>
</div>
<p>This is non-trivial: We will see later a simple example where each buyer wants two goods and a competitive equilibrium does <em>not</em> exist.</p>
<h2 id="deferred-acceptance-with-prices">Deferred Acceptance With Prices</h2>
<p>Let's consider the following setting:</p>
<ul>
<li><strong>Assumption:</strong> Prices are always in some finite range (e.g., <span class="arithmatex">\(\$0-\$1,000\)</span>), with finite increments (e.g., <span class="arithmatex">\(\$1\)</span>).</li>
<li><strong>Ordinal Preferences:</strong> For each buyer, we construct a list of all the <span class="arithmatex">\((good,price)\)</span> options, ordered by utility. We can truncate the list a the <span class="arithmatex">\((receive \;nothing, pay \; nothing)\)</span> option.</li>
<li><strong>At each iteration of the algorithm</strong>: The unmatched buyer whose next-favorite option is <span class="arithmatex">\((j,p)\)</span> proposes price <span class="arithmatex">\(p\)</span> to good <span class="arithmatex">\(j\)</span>. Good <span class="arithmatex">\(j\)</span> tentatively accepts if price <span class="arithmatex">\(p\)</span> is higher than the prices it was offered so far.</li>
</ul>
<p>This is a twist on the DA we saw before because it is <strong>DA with prices</strong>. Here, ordinal preferences are not only established (like in the past) based on ordinarily over rooms, but over combinations of rooms and prices. We can truncate the list at the (receive nothing, pay nothing) option, which is like an outside option (e.g. sleep in a tent instead). Note that the room preferences (over buyers) are only based on prices (i.e. rooms are indifferent over buyers).</p>
<div class="example">
<p>Let's consider the following scenario, when Mario, Luigi, and Yoshi are going to Paris and are looking for a place to stay near famous monuments:</p>
<ul>
<li>Mario is willing to pay <span class="arithmatex">\(18\)</span> for the room near the Eiffel Tower, and <span class="arithmatex">\(16\)</span> for the room near the Pasteur Institute.</li>
<li>Luigi is willing to pay <span class="arithmatex">\(14\)</span> for the room near the Eiffel Tower, and <span class="arithmatex">\(6\)</span> for the room near the Pasteur Institute.</li>
<li>Mario is willing to pay <span class="arithmatex">\(12\)</span> for the room near the Eiffel Tower, and <span class="arithmatex">\(8\)</span> for the room near the Pasteur Institute.</li>
</ul>
<p>Here is the result:</p>
<p><img alt="Deferred Acceptance with Prices Example" src="../images/Deferred%20Acceptance%20with%20Prices%20Example.png" /></p>
</div>
<p>This is an overview of what happened:</p>
<ul>
<li>When the prices are <span class="arithmatex">\(2\)</span> for Eiffel Tower or <span class="arithmatex">\(0\)</span> for Pasteur, Mario is indifferent between both rooms, so Mario proposes <span class="arithmatex">\(0\)</span> to Pasteur.</li>
<li>But Luigi and Yoshi still competing for Eiffel Tower, so they keep raising their prices, until the price for Eiffel Tower is <span class="arithmatex">\(4\)</span>, which means that Yoshi is now indifferent between the two rooms.</li>
<li>Then, Yoshi is going to switch back and forth between Paster and Eiffel Tower as Mario and Luigi raise the price for Eiffel Tower (every time one place is over-demanded and Mario and Luigi raise the price, Yoshi switches to the other one)- …</li>
<li>… until Yoshi gets priced out.</li>
</ul>
<p><strong>Note:</strong> For more details, refer to slides 37-61.</p>
<p><strong>Question: What causes Mario to become indifferent to the Eiffel Tower in the first place?</strong></p>
<p>When the Eiffel Tower costs <span class="arithmatex">\(2\)</span> and Pasteur costs <span class="arithmatex">\(0\)</span>, the difference between both rooms is <span class="arithmatex">\(2\)</span> more in favor of the Eiffel Tower. Mario’s preference for the Eiffel Tower over Pasteur is <span class="arithmatex">\(2\)</span> more, which exactly balances the difference of <span class="arithmatex">\(2\)</span>.</p>
<p>Here is how to interpret the results:</p>
<ul>
<li>The price that Mario wants to pay for Pasteur (<span class="arithmatex">\(9\)</span>) is higher than Yoshi’s (<span class="arithmatex">\(8\)</span>), and similarly, the price Luigi wants to pay for Eiffel Tower (<span class="arithmatex">\(12\)</span>) is equal than Yoshi’s (<span class="arithmatex">\(12\)</span>).</li>
<li>Mario could have also paid <span class="arithmatex">\(8\)</span>, but this is just due to how the tie-breaking worked out.</li>
<li>This is the matching that maximizes the total values on the edges.</li>
<li>This is not only a competitive equilibrium, it is also the unique buyer-optimal competitive equilibrium.</li>
</ul>
<p><strong>Question: Does the order matter?</strong></p>
<p>Just like in DA, order does not really matter, except for when it comes to tie-breaking, which may only matter up to <span class="arithmatex">\(1\)</span> (increment).</p>
<p><strong>Question: What is the total social welfare 16 +14?</strong></p>
<p>Yes. <span class="arithmatex">\(12+9\)</span> are the prices that Mario and Luigi pay. The welfare is the value that Mario see in Pasteur (<span class="arithmatex">\(16\)</span>) and Luigi sees in Eiffel Tower (<span class="arithmatex">\(14\)</span>). In other words, it is not about how much buyers actually pay for the rooms, but how much they are willing to pay for the room.</p>
<p><strong>Question: Are Luigi and Mario determining the prices based on the maximum prices that Luigi is willing to pay?</strong></p>
<p>Yes, because these are the prices it takes to price Yoshi out (since there is one more buyer than room, we need to price out one buyer).</p>
<div class="theorem">
<p><strong>Claim:</strong> Da with prices always terminates.</p>
</div>
<p>The algorithm always terminates because every buyer is either matched to a good or they reach a point where they prefer to pay nothing and buy nothing.</p>
<div class="definition">
<p>The running time of DA with prices is in the order of <span class="arithmatex">\(O(n \cdot m \cdot i)\)</span>, where <span class="arithmatex">\(i\)</span> is the number of increments.</p>
</div>
<p>The running time is at most the number of buyers (<span class="arithmatex">\(n\)</span>) times the number of rooms (<span class="arithmatex">\(m\)</span>) times the number of increments (<span class="arithmatex">\(i\)</span>), i.e 1,000 increments of $1 our example. This is really fast when (<span class="arithmatex">\(i\)</span>) is small (and there is a way to make it faster when (<span class="arithmatex">\(i\)</span>) is not too small), so it is a really fast algorithm with nice economic properties.</p>
<div class="remark">
<p>The DA with prices algorithm finds a competitive equilibrium:</p>
<ol>
<li>Each buyer is matched to their favorite <span class="arithmatex">\(\(good,price\)</span>). If there were any more preferred <span class="arithmatex">\(\(good,price\)</span>), the buyer would have already proposed and get kicked out, so the other goods raise the price higher.</li>
<li>If a good is unmatched, its price is zero. Once a buyer proposes to a good, a good is always matched, even if to another buyer (and its price is above <span class="arithmatex">\(0\)</span>), so the only way a good is unmatched is if it is never proposed to (and its price is <span class="arithmatex">\(0\)</span>).</li>
</ol>
<p>Bonus Features (inherited from DA):</p>
<ul>
<li>Buyer-optimal among competitive equilibria.</li>
<li>Buyer-strategyproof.</li>
</ul>
<p><strong>Note:</strong> This is not seller-strategy proof though, since they can set a reserve price, i.e. a minimum price that needs to be met.</p>
</div>
<div class="summary">
<p><strong>DA with Prices Recap</strong></p>
<p>At each iteration of the algorithm, the unmatched buyer whose next-favorite option is <span class="arithmatex">\((j,p)\)</span> proposes price <span class="arithmatex">\(p\)</span> to good <span class="arithmatex">\(j\)</span>. Good <span class="arithmatex">\(j\)</span> tentatively accepts if price <span class="arithmatex">\(p\)</span> is higher than the prices it was offered so far.</p>
<ul>
<li>Proves that a competitive equilibrium exists.</li>
<li>Fast running time (for discretized prices).</li>
<li>Buyer-optimal and buyer-strategyproof.</li>
</ul>
</div>
<div class="summary">
<p><strong>Competitive Equilibrium Recap</strong></p>
<p>By definition:</p>
<ul>
<li>Each buyer is matched to their favorite good (given prices).</li>
<li>If no buyer is matched to good <span class="arithmatex">\(j\)</span>, then <span class="arithmatex">\(p_j = 0\)</span>.</li>
</ul>
<p>Properties:</p>
<ul>
<li>At equilibrium prices, buyers can independently choose their favorite goods without conflicts.</li>
<li>A competitive equilibrium maximizes social welfare.</li>
<li>A competitive equilibrium always exists and can be found efficiently (DA with prices).</li>
</ul>
</div>
<h2 id="recap">Recap</h2>
<div class="summary">
<p><strong>Market Equilibrium Recap</strong></p>
<p>Modeling buyers</p>
<ul>
<li>Ordinal vs. cardinal utilities (expressivity, fairness, combining outcomes).</li>
<li>Idiosyncratic vs. fungible goods (and unit-demand vs. combinatorial demand).</li>
</ul>
<p>Competitive equilibrium (supply meets demand)</p>
<ul>
<li>Prices coordinate the allocation (i.e. each guest can book their favorite room without conflicts).</li>
<li>Proof of existence with DA with prices algorithm (it is also a buyer-strategyproof mechanism).</li>
<li>First Welfare theorem (social welfare maximized at equilibrium).</li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.sections"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
      
        <script src="../javascript/katex-init.js"></script>
      
    
  </body>
</html>